let site_url,resize_ended,is_green_hosted,avg_mix,print_project_name=document.querySelector(".project_name"),data_project_name="No name",installed_on="00-0000",refresh=!1,first_load=!0,graphic_view="days",data_visits=0,data_bandwidth_usage=0,data_bandwidth_usage_high=0,data_energy_usage=0,data_energy_usage_high=0,data_co2e=0,data_co2e_high=0,data_energy_mix=0,data_energy_fossil_free=0,log_files=[],data_to_display=[],pages=[],url_keys=[],days=[],days_keys=[],print_visits=document.querySelector(".block_visits .value"),print_bandwidth_usage=document.querySelector(".block_bandwidth .value"),print_energy_usage=document.querySelector(".block_energy .value"),print_co2e=document.querySelector(".block_co2 .value"),print_energy_mix=document.querySelector(".block_mix .value"),monitored_container=document.querySelector(".monitored_graph .graphic"),print_equiv_title=document.querySelector(".equiv_weight"),print_equiv_tree=document.querySelector(".equiv_tree .sentence"),print_equiv_thermic_car=document.querySelector(".equiv_car .sentence"),print_equiv_evbike=document.querySelector(".equiv_evbike .sentence"),print_equiv_bee=document.querySelector(".equiv_bees .sentence"),distribution_container=document.querySelector(".distribution ul"),month_selector=document.querySelector("#month-selector"),year_selector=document.querySelector("#year-selector"),apply=document.querySelector(".apply"),button_refresh=document.querySelector(".refresh_data"),ratio_networks=.24,ratio_devices=.54,ratio_datacenters=.22,kwh_per_gb=.194,intensity_default=494,intensity_greenhosted=50,intensity_datacenters=intensity_default,kwh_dt=.055,kwh_network=.059,kwh_device=.08;function init_lowwwimpact(){fetch("/lowwwimpact_stats/config.json").then((function(e){return e.json()})).then((function(e){installed_on=e.installed_on,data_project_name=e.project_name,site_url=e.site_url,is_green_hosted=e.is_green_hosted,1==is_green_hosted&&(intensity_datacenters=intensity_greenhosted),print_project_name.textContent=data_project_name,document.title=data_project_name+" Â· lowwwimpact.stats",log_files.push(installed_on),list_logs(installed_on)}))}function list_logs(e){let t=new Date,n=Number(t.getMonth()+1),r=t.getFullYear(),i=e.split("-"),o=Number(i[1]),a=Number(i[0]);addyear(a);let l=month_selector.querySelector('option[data-month="'+n+'"]').textContent;for(month_selector.querySelector('option[value="empty"]').setAttribute("hidden","hidden"),month_selector.value=l;a+"-"+o!=r+"-"+n;){12==o?(o=1,a++,addyear(a)):o++;let e=o;e<10&&(e="0"+e);let t=a+"-"+e;log_files.push(t)}select_year(r)}function select_year(e){year_selector.value=e,year_selector.querySelector('option[value="empty"]').setAttribute("hidden","hidden");for(let t=1;t<=12;t++){let n=t;n<10&&(n="0"+n);let r=e+"-"+n;log_files.includes(r)?month_selector.querySelector('option[data-month="'+t+'"]').removeAttribute("disabled"):month_selector.querySelector('option[data-month="'+t+'"]').setAttribute("disabled","disabled")}1==first_load&&(first_load=!1,load_logs())}function check_selection(){return"alltime"!=document.querySelector('.time_selector input[name="time"]:checked').id?"empty"!=month_selector.value&&"empty"!=year_selector.value||"empty"!=year_selector.value&&"year"==document.querySelector('.time_selector input[name="time"]:checked').id?(apply.removeAttribute("disabled"),apply.classList.remove("hidden"),!0):(apply.setAttribute("disabled","disabled"),!1):"alltime"==document.querySelector('.time_selector input[name="time"]:checked').id||void 0}function load_logs(e){if(1==check_selection()){apply.classList.add("hidden");let t=[],n=[],r=0,i=document.querySelector('input[name="time"]:checked').id;if("year"==i){graphic_view="months";let e=year_selector.value;log_files.forEach((n=>{n.includes(e)&&t.push(n)}))}else if("month"==i){graphic_view="days";let e=year_selector.value,n=(month_selector.value,month_selector.options[month_selector.selectedIndex].getAttribute("data-month"));n<10&&(n="0"+n);let r=e+"-"+n;log_files.includes(r)&&t.push(r)}else t=log_files,graphic_view="months";r=t.length,t.forEach((t=>{reset_parsing();let r=!!localStorage[t]&&JSON.parse(localStorage[t]).expire,i=Date.now(),o=new Date(i),a=r<Date.parse(o);if(null!=localStorage[t]&&0==a){let e=JSON.parse(localStorage[t]);n.push(e)}else 1==e?fetch("/lowwwimpact_stats/log/"+t+".log?url=FALSE&stamp="+i).then((function(e){return e.text()})).then((function(e){data_logs=e.split("\n"),data_logs.pop();let r=parse_data(t,data_logs);n.push(r)})):fetch("/lowwwimpact_stats/cache/"+t+".json?url=FALSE&stamp="+i).then((function(e){return e.json()})).then((function(e){window.localStorage.setItem(t,JSON.stringify(e)),n.push(e)})).catch((e=>{fetch("/lowwwimpact_stats/log/"+t+".log?url=FALSE&stamp="+i).then((function(e){return e.text()})).then((function(e){data_logs=e.split("\n"),data_logs.pop();let r=parse_data(t,data_logs);n.push(r)}))}))}));let o=setInterval((()=>{n.length==r&&(clearInterval(o),!0===refresh&&(refresh=!1,document.querySelector(".lowwwimpact_banner.success").classList.add("active"),document.querySelector(".lowwwimpact main").classList.remove("loading"),setTimeout((()=>{document.querySelector(".lowwwimpact_banner.refresh").classList.remove("active"),document.querySelector(".lowwwimpact_banner.success").classList.remove("active")}),4e3)),setTimeout((()=>{document.querySelector(".lowwwimpact_banner.refresh").classList.remove("active"),"days"==graphic_view?display_data_days(n):display_data_months(n)}),1e3),document.querySelector(".lowwwimpact main").classList.remove("loading"))}),100)}}function parse_data(e,t){let n=[];reset_parsing(),t.forEach((e=>{let t=1,r=e.split(", ");r[0];data_bandwidth_usage+=Number(r[5]),data_bandwidth_usage_high+=Number(r[6]);let i,o=new Date(Number(r[0])).getDate();1==n.includes(r[0])?t=0:(data_visits++,data_energy_fossil_free+=Number(r[3]),data_energy_mix+=Number(r[4]));let a=!0;0==url_keys.includes(r[1])?(url_keys.push(r[1]),i=url_keys.length-1):(i=url_keys.indexOf(r[1]),a=!1);let l,s=[r[1],Number(r[5])+Number(r[6]),t];if(1==a)pages.push(s);else{let e=pages[i],n=[r[1],Number(e[1])+Number(r[5])+Number(r[6]),Number(e[2])+t];pages[i]=n}let c=!0;0==days_keys.includes(o)?(days_keys.push(o),l=days_keys.length-1):(l=days_keys.indexOf(o),c=!1);let u=[o,Number(r[5]),Number(r[6]),t];if(1==c)days.push(u);else{let e=days[l],n=[o,Number(r[5])+Number(e[1]),Number(r[6])+Number(e[2]),Number(e[3])+t];days[l]=n}n.push(r[0]),n.length>5&&n.shift()}));let r=!1;log_files[log_files.length-1]==e&&(r=new Date(Date.now()+864e5),r=Date.parse(r));let i={period:e,views:data_visits,fsp:data_energy_fossil_free/data_visits,mix:data_energy_mix/data_visits,min_bandwidth:data_bandwidth_usage,plus_bandwidth:data_bandwidth_usage_high,distribution:pages,daily:days,expire:r};if(navigator.sendBeacon){let e="/lowwwimpact_stats/cache.php?url=TRUE",t=new Blob([JSON.stringify(i)],{type:"application/json"});navigator.sendBeacon(e,t)}return window.localStorage.setItem(e,JSON.stringify(i)),i}function display_data_days(e){let t=merge_data_days(e),n=1e9,r=t.bandwidth/n;print_visits.textContent=format_nb(t.views,0),print_bandwidth_usage.textContent=format_nb(r,3),print_energy_usage.textContent=format_nb(r*kwh_per_gb,3),avg_mix=t.mix*ratio_devices+intensity_default*ratio_networks+ratio_datacenters*intensity_datacenters,print_energy_mix.textContent=format_nb(avg_mix,2);let i=r*kwh_dt*avg_mix+r*kwh_device*avg_mix+r*kwh_network*avg_mix;if(print_co2e.textContent=format_nb(i,2),print_equiv_title.textContent=format_nb(i,2),document.querySelector(".equiv_unit").textContent="gr",i>=1e3){let e=i/1e3;document.querySelector(".equiv_unit").textContent="kg",print_equiv_title.textContent=format_nb(e,2)}print_equiv_tree.textContent="An adult Oak would absorb this within "+tree_equivalence(i)+".",print_equiv_bee.textContent="It weights the same as "+bees_equivalence(i)+" bees.",print_equiv_evbike.textContent=distance_equivalence(i,.002)+" with an EV-Bike.",print_equiv_thermic_car.textContent=distance_equivalence(i,.152)+" with a thermic car.";let o=[];t.distribution[0].forEach((e=>{let n=t.distribution[0].indexOf(e),r=[t.distribution[1][n][0],t.distribution[1][n][1],e];o.push(r),o.sort((function(e,t){return t[0]-e[0]}))}));let a=0,l=0;for(let e=0;e<o.length;e++)if(e>=1){let t=o[e];a+=t[1],l+=t[0]}for(let e=0;e<o.length;e++)e>=1&&o.splice(e,1);if(0!=l&&0!=a){let e=[l,a,"Rest of website"];o.push(e)}distribution_container.innerHTML="",o.forEach((e=>{let t=document.querySelector(".template_url").content.cloneNode(!0);t.querySelector("a").textContent=e[2],t.querySelector(".visits").textContent=format_nb(e[1],0),t.querySelector("a").setAttribute("href",e[2]);let n=1,r=e[0]/1e9*avg_mix;r>=1e3&&(r/=1e3,n=1e3,t.querySelector(".page_share_unit").textContent="kg"),t.querySelector(".view_gr").textContent=format_nb(r*n/e[1],2),t.querySelector(".total_kg").textContent=format_nb(r,2),distribution_container.appendChild(t)}));let s=t.daily.slice().sort((function(e,t){return t[1]+t[2]-(e[1]+e[2])})),c=s[0][2]+s[0][1],u=c.toString().length,d=roundUp(c,u),_=roundDown(0,u),m=c/1e9*avg_mix,h=roundUp(m,2),p=graphic_steps(roundDown(0,2),h),y=graphic_steps(_,d),g=0,b=1e6;document.querySelector(".bandwidth-unit").textContent="(mb)",c>=1e9&&(b=1e9,document.querySelector(".bandwidth-unit").textContent="(gb)");document.querySelector(".co2-unit").textContent="(gr)",m>=1e3&&(b=1e3,document.querySelector(".co2-unit").textContent="(kg)"),document.querySelectorAll(".col-sticky .row").forEach((e=>{e.querySelector(".row-co2").textContent=format_nb(p[g]/1,3),e.querySelector(".row-bandwidth").textContent=format_nb(y[g]/b,3),g++}));let f=t.daily.slice(),v=t.period,w=getDaysInMonth(v[0],v[1]);f=f.sort((function(e,t){return e[0]-t[0]}));let q=[];for(let e=1;e<=w;e++)if(null!=f[0]&&f[0][0]==e){let e=f[0];f.shift(),q.push(e)}else q.push([e,0,0,0]);let S=2.56;monitored_container.querySelector(".graphic-data").innerHTML="",q.forEach((e=>{let t=document.querySelector(".template_day").content.cloneNode(!0),r=100/d*e[1]*S,i=100/d*(e[1]+e[2])*S-r;0==i&&(i=5);let o="height: "+i+"px; bottom:"+r+"px";t.querySelector(".col-item-graphic-bandwidth").setAttribute("style",o);let a=e[1]/n*avg_mix,l=(e[1]+e[2])/n*avg_mix,s=100/h*a*S,c=100/h*l*S-s;0==c&&(c=5);let u="height: "+c+"px; bottom:"+s+"px";t.querySelector(".col-item-graphic-co2").setAttribute("style",u),t.querySelector(".col-item-graphic").setAttribute("data-min",e[1]),t.querySelector(".col-item-graphic").setAttribute("data-max",e[1]+e[2]),t.querySelector(".col-item-number").textContent=e[0],t.querySelector(".col-item-visits").textContent=e[3],monitored_container.querySelector(".graphic-data").appendChild(t)})),document.querySelector(".col-item-number").textContent="Day"}function merge_data_days(e){data_visits=0,data_bandwidth_usage=0,data_bandwidth_usage_high=0,data_energy_mix=0,data_energy_fossil_free=0;let t=[],n=[],r=e.length;return e.forEach((e=>{data_visits+=e.views,data_bandwidth_usage+=e.min_bandwidth,data_energy_mix+=e.mix,data_days=e.daily,data_period=e.period,e.distribution.forEach((e=>{let r=e[0],i=[e[1],e[2]];if(t.includes(r)){let i=t.indexOf(r),o=n[i],a=[Number(o[0])+Number(e[1]),Number(o[1])+Number(e[2])];n[i]=a}else t.push(r),n.push(i)}))})),{period:data_period,views:data_visits,bandwidth:data_bandwidth_usage,mix:data_energy_mix/r,distribution:[t,n],daily:data_days}}function display_data_months(e){let t=merge_data_months(e),n=1e9,r=t.bandwidth/n;print_visits.textContent=format_nb(t.views,0),print_bandwidth_usage.textContent=format_nb(r,3),print_energy_usage.textContent=format_nb(r*kwh_per_gb,3);let i=t.mix*ratio_devices+intensity_default*ratio_networks+ratio_datacenters*intensity_datacenters;print_energy_mix.textContent=format_nb(i,2);let o=r*kwh_dt*i+r*kwh_device*i+r*kwh_network*i;if(print_co2e.textContent=format_nb(o,2),print_equiv_title.textContent=format_nb(o,2),document.querySelector(".equiv_unit").textContent="gr",o>=1e3){let e=o/1e3;document.querySelector(".equiv_unit").textContent="kg",print_equiv_title.textContent=format_nb(e,2)}print_equiv_tree.textContent="An adult Oak would absorb this within "+tree_equivalence(o)+".",print_equiv_bee.textContent="It weights the same as "+bees_equivalence(o)+" bees.",print_equiv_evbike.textContent=distance_equivalence(o,.002)+" with an EV-Bike.",print_equiv_thermic_car.textContent=distance_equivalence(o,.152)+" with a thermic car.";let a=[];t.distribution[0].forEach((e=>{let n=t.distribution[0].indexOf(e),r=[t.distribution[1][n][0],t.distribution[1][n][1],e];a.push(r),a.sort((function(e,t){return t[0]-e[0]}))}));let l=0,s=0;for(let e=0;e<a.length;e++)if(e>=1){let t=a[e];l+=t[1],s+=t[0]}for(let e=0;e<a.length;e++)e>=1&&a.splice(e,1);if(0!=s&&0!=l){let e=[s,l,"Rest of website"];a.push(e)}distribution_container.innerHTML="",a.forEach((e=>{let t=document.querySelector(".template_url").content.cloneNode(!0);t.querySelector("a").textContent=e[2],t.querySelector(".visits").textContent=format_nb(e[1],0),t.querySelector("a").setAttribute("href",e[2]);let n=1,r=e[0]/1e9*i;r>=1e3&&(r/=1e3,n=1e3,t.querySelector(".page_share_unit").textContent="kg"),t.querySelector(".view_gr").textContent=format_nb(r*n/e[1],2),t.querySelector(".total_kg").textContent=format_nb(r,2),distribution_container.appendChild(t)}));let c=t.monthly.slice().sort((function(e,t){return t[1]+t[2]-(e[1]+e[2])})),u=c[0][2]+c[0][1],d=u.toString().length,_=roundUp(u,d),m=roundDown(0,d),h=u/n*i,p=roundUp(h,1),y=graphic_steps(roundDown(0,1),p),g=graphic_steps(m,_),b=0,f=1e6;document.querySelector(".bandwidth-unit").textContent="(mb)",u>=1e9&&(f=1e9,document.querySelector(".bandwidth-unit").textContent="(gb)");document.querySelector(".co2-unit").textContent="(gr)",h>=1e3&&(f=1e3,document.querySelector(".co2-unit").textContent="(kg)"),document.querySelectorAll(".col-sticky .row").forEach((e=>{e.querySelector(".row-co2").textContent=format_nb(y[b]/1,3),e.querySelector(".row-bandwidth").textContent=format_nb(g[b]/f,3),b++}));let v=t.monthly.slice();col_amount=t.period,v=v.sort();let w=[];if(12==col_amount)for(let e=0;e<col_amount;e++)if(null!=v[e]){let t=v[e][0].split("-"),n=Number(t[1]);if(n==e+1){let t=v[e];t[0]=n,w.push(t)}}else w.push([e+1,0,0,0]);else w=v.slice();let q=2.56;monitored_container.querySelector(".graphic-data").innerHTML="",w.forEach((e=>{let t=document.querySelector(".template_day").content.cloneNode(!0),r=100/_*e[1]*q,o=100/_*(e[1]+e[2])*q-r;0==o&&(o=5);let a="height: "+o+"px; bottom:"+r+"px";t.querySelector(".col-item-graphic-bandwidth").setAttribute("style",a);let l=e[1]/n*i,s=(e[1]+e[2])/n*i,c=100/p*l*q,u=100/p*s*q-c;0==u&&(u=5);let d="height: "+u+"px; bottom:"+c+"px";t.querySelector(".col-item-graphic-co2").setAttribute("style",d),t.querySelector(".col-item-graphic").setAttribute("data-min",e[1]),t.querySelector(".col-item-graphic").setAttribute("data-max",e[1]+e[2]),t.querySelector(".col-item-number").textContent=e[0],t.querySelector(".col-item-visits").textContent=e[3],monitored_container.querySelector(".graphic-data").appendChild(t)})),document.querySelector(".col-item-number").textContent="Month"}function merge_data_months(e){data_visits=0,data_bandwidth_usage=0,data_bandwidth_usage_high=0,data_energy_mix=0,data_energy_fossil_free=0;let t=[],n=[],r=[],i=e.length,o=12;return i>12&&(o=i),e.forEach((e=>{data_visits+=e.views,data_bandwidth_usage+=e.min_bandwidth,data_energy_mix+=e.mix;let i=0,o=0,a=0;e.daily.forEach((e=>{i+=Number(e[1]),o+=Number(e[2]),a+=Number(e[3])}));let l=[e.period,i,o,a];r.push(l),e.distribution.forEach((e=>{let r=e[0],i=[e[1],e[2]];if(t.includes(r)){let i=t.indexOf(r),o=n[i],a=[Number(o[0])+Number(e[1]),Number(o[1])+Number(e[2])];n[i]=a}else t.push(r),n.push(i)}))})),{period:o,views:data_visits,bandwidth:data_bandwidth_usage,mix:data_energy_mix/i,distribution:[t,n],monthly:r}}function graphic_steps(e,t){let n=[t];for(let r=1;r<=3;r++){let i=(t-e)/4*r+e;n.push(i)}return n.sort((function(e,t){return t-e})),n}function round(e,t){return Number(Math.ceil(e+"e"+t)+"e-"+t)}function format_nb(e,t){e=(e=round(e,t)).toString();for(var n=/(-?\d+)(\d{3})/;n.test(e);)e=e.replace(n,"$1'$2");return e}function distance_equivalence(e,t){let n=1e3*t,r=" kilometer",i=format_nb(1/n*e,1);return 1/n*e>2&&(r=" kilometers"),i+=r,i}function bees_equivalence(e){return format_nb(e/.11,0)}function tree_equivalence(e){let t=" year",n=format_nb(1/18870*e,2);return 1/18870*e>2&&(t=" years"),n+=t,n}function getDaysInMonth(e,t){return new Date(e,t,0).getDate()}function roundUp(e,t){let n=.1*Math.pow(10,t);return Math.ceil(e/n)*n}function roundDown(e,t){let n=.1*Math.pow(10,t);return Math.floor(e/n)*n}function addyear(e){let t=document.createElement("option");t.text=e,year_selector.add(t)}function reset_parsing(){days=[],days_keys=[],url_keys=[],pages=[],data_visits=0,data_bandwidth_usage=0,data_bandwidth_usage_high=0,data_energy_usage=0,data_energy_usage_high=0,data_co2e=0,data_co2e_high=0,data_energy_mix=0,data_energy_fossil_free=0}function toggleAccordion(e,t){if("H4"==t.target.nodeName||"DIV"==t.target.nodeName){e.classList.toggle("open");e.parentNode;let t=e.querySelector(".accordion-content").getBoundingClientRect().height,n=e.getBoundingClientRect().height;0==e.getAttribute("style")||null==e.getAttribute("style")?e.setAttribute("style","height:"+(t+n+32)+"px"):e.removeAttribute("style")}}function timeselect(e){let t=e.querySelector('input[name="time"]:checked').id;"year"==t?(year_selector.classList.remove("hide"),year_selector.querySelector('option[value="empty"]').removeAttribute("hidden"),year_selector.value="empty",month_selector.classList.add("hide"),apply.classList.remove("hidden"),apply.setAttribute("disabled","disabled")):"month"==t?(year_selector.classList.remove("hide"),year_selector.querySelector('option[value="empty"]').removeAttribute("hidden"),year_selector.value="empty",month_selector.classList.remove("hide"),month_selector.querySelector('option[value="empty"]').removeAttribute("hidden"),month_selector.value="empty",apply.classList.remove("hidden"),apply.setAttribute("disabled","disabled")):(year_selector.classList.add("hide"),month_selector.classList.add("hide"),apply.setAttribute("disabled","disabled"),apply.classList.add("hidden"),load_logs())}function reset_accordion(){document.querySelectorAll(".accordion").forEach((function(e){e.classList.remove("open"),e.removeAttribute("style")}))}function updateMonthsAvailable(e){let t=document.querySelector('.time_selector input[name="time"]:checked').id;document.querySelector("#year-selector"),document.querySelector("#month-selector");if(year_selector.querySelector('option[value="empty"]').setAttribute("hidden","hidden"),"month"==t){select_year(e.value),month_selector.querySelector('option[value="empty"]').removeAttribute("hidden"),month_selector.value="empty"}check_selection()}function removeEmptyMonth(){"empty"!=month_selector.value&&month_selector.querySelector('option[value="empty"]').setAttribute("hidden","hidden"),check_selection()}function refresh_data(){let e=log_files[log_files.length-1];localStorage.removeItem(e);let t=e.split("-");year_selector.value=Number(t[0]),month_selector.value=month_selector.querySelector('option[data-month="'+Number(t[1])+'"]').getAttribute("value"),refresh=!0,window.scrollTo(0,0),load_logs(!0),document.querySelector(".lowwwimpact_banner.refresh").classList.add("active"),document.querySelector(".lowwwimpact main").classList.add("loading")}function colhover(e){let t=e.querySelector(".col-item-graphic").getAttribute("data-min")/1e6,n=e.querySelector(".col-item-graphic").getAttribute("data-max")/1e6,r="mb",i=t/1e3*avg_mix,o=n/1e3*avg_mix,a="gr";n>=1e3&&(n/=1e3,t/=1e3,r="gb"),o>=1e3&&(o/=1e3,i/=1e3,a="kg"),t=format_nb(t,2),n=format_nb(n,2),i=format_nb(i,2),o=format_nb(o,2);let l=t+" - "+n+r;t==n&&(l=n+r);let s=i+" - "+o+a;o==i&&(s=o+a);let c="Bandwidth: "+l+"\nCO2eq: "+s;e.setAttribute("data-hover",c)}window.onresize=function(){clearTimeout(resize_ended),resize_ended=setTimeout(reset_accordion,50)},document.addEventListener("DOMContentLoaded",init_lowwwimpact,!1);
//# sourceMappingURL=lowwwimpact_dashboard.js.map